.');
      }
      
      btn.disabled = false;
      btn.textContent = 'Delete';
    });
    
    // Show app screen
    function showAppScreen() {
      loginScreen.classList.add('hidden');
      joinScreen.classList.add('hidden');
      appScreen.classList.remove('hidden');
      
      if (isAdmin) {
        adminSection.classList.remove('hidden');
        memberSection.classList.add('hidden');
        loadMessages();
        loadMembers();
      } else {
        adminSection.classList.add('hidden');
        memberSection.classList.remove('hidden');
        loadMemberMessages();
      }
    }
    
    // Load messages
    async function loadMessages() {
      try {
        const res = await fetch('/api/messages');
        const messages = await res.json();
        
        const list = document.getElementById('messages-list');
        
        if (messages.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“­</div>
              <p>No messages yet</p>
            </div>
          `;
          return;
        }
        
        list.innerHTML = messages.map(msg => `
          <div class="message-item">
            <div class="message-header">
              <span class="message-sender">${escapeHtml(msg.sender)}</span>
              <span class="message-time">${formatTime(msg.sentAt)}</span>
            </div>
            <div class="message-text">${escapeHtml(msg.text)}</div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Failed to load messages:', error);
      }
    }
    
    // Load member messages
    async function loadMemberMessages() {
      try {
        const res = await fetch('/api/messages');
        const messages = await res.json();
        
        const list = document.getElementById('member-messages-list');
        
        if (messages.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“­</div>
              <p>No messages yet</p>
            </div>
          `;
          return;
        }
        
        list.innerHTML = messages.map(msg => `
          <div class="message-item">
            <div class="message-header">
              <span class="message-sender">${escapeHtml(msg.sender)}</span>
              <span class="message-time">${formatTime(msg.sentAt)}</span>
            </div>
            <div class="message-text">${escapeHtml(msg.text)}</div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Failed to load messages:', error);
      }
    }
    
    // Load members
    async function loadMembers() {
      try {
        const res = await fetch('/api/members', {
          headers: { 'X-Admin-Code': adminCode }
        });
        const members = await res.json();
        
        const list = document.getElementById('members-list');
        
        if (members.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ‘¥</div>
              <p>No members yet</p>
            </div>
          `;
          return;
        }
        
        list.innerHTML = members.map(member => `
          <div class="member-item">
            <div class="member-avatar">${member.name.charAt(0).toUpperCase()}</div>
            <div class="member-info">
              <div class="member-name">${escapeHtml(member.name)} ${member.isAdmin ? 'ğŸ‘‘' : ''}</div>
              <div class="member-details">
                ${member.hasPhone ? 'ğŸ“±' : ''}${member.hasPush ? 'ğŸ””' : ''} 
                Joined ${formatDate(member.joinedAt)}
              </div>
            </div>
            <div class="member-actions">
              <button onclick="editMember('${member.id}', '${escapeHtml(member.name)}', '${member.phone || ''}', ${member.isAdmin})" title="Edit">âœï¸</button>
              <button onclick="confirmDelete('${member.id}', '${escapeHtml(member.name)}')" title="Delete">ğŸ—‘ï¸</button>
            </div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Failed to load members:', error);
      }
    }
    
    // Edit member
    function editMember(id, name, phone, isAdminMember) {
      editingMemberId = id;
      document.getElementById('modal-title').textContent = 'Edit Member';
      document.getElementById('modal-name').value = name;
      document.getElementById('modal-phone').value = phone || '';
      document.getElementById('modal-admin').checked = isAdminMember;
      document.getElementById('modal-name-error').classList.add('hidden');
      document.getElementById('modal-status').classList.add('hidden');
      memberModal.classList.remove('hidden');
    }
    
    // Confirm delete
    function confirmDelete(id, name) {
      deletingMemberId = id;
      document.getElementById('delete-message').textContent = `Are you sure you want to delete ${name}?`;
      deleteModal.classList.remove('hidden');
    }
    
    // Utility functions
    function showStatus(elementId, message, type) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = `status ${type}`;
      el.classList.remove('hidden');
      
      if (type === 'success') {
        setTimeout(() => el.classList.add('hidden'), 3000);
      }
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function formatTime(isoString) {
      const date = new Date(isoString);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      
      return date.toLocaleDateString();
    }
    
    function formatDate(isoString) {
      return new Date(isoString).toLocaleDateString();
    }
    
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding)
        .replace(/-/g, '+')
        .replace(/_/g, '/');
      
      const rawData = window.atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      
      for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }
      return outputArray;
    }
    
    // Start the app
    init();
  </script>
</body>
</html>
